<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ham.len.admin.notice.NoticeDAO">

<sql id="searchNotice">
<choose> 
    <when test="kind=='writer'">EMPLOYEE_ID</when>
    <when test="kind=='contents'">NOTICE_CONTENTS</when>
    <otherwise>NOTICE_TITLE</otherwise>
</choose> 

</sql>

  <select id="getList" parameterType="Pager" resultMap="getNoticeList">
     SELECT *,FN_CODE_NM(LEFT(NOTICE_PRIORITY_CD,3),NOTICE_PRIORITY_CD) AS PRIOR_CD_NAME,
     FN_CODE_NM(LEFT(NOTICE_CATEGORY_CD,3),NOTICE_CATEGORY_CD) AS CATEGORY_CD_NAME
     FROM NOTICE N INNER JOIN HUMAN_RESOURCE HR
       ON N.EMPLOYEE_ID=HR.EMPLOYEE_ID
  </select>
  
  <resultMap type="NoticeVO" id="getNoticeList">
     <id column="NOTICE_NO" property="noticeNo"/>
     <result column="EMPLOYEE_ID" property="employeeID"/>
     <result column="NOTICE_TITLE" property="noticeTitle"/>
     <result column="NOTICE_CONTENTS" property="noticeContents"/>
     <result column="NOTICE_HIT" property="noticeHit"/>
     <result column="PRIOR_CD_NAME" property="priorCdName"/>
     <result column="CATEGORY_CD_NAME" property="categoryCdName"/>
     
     <association property="humanResourceVO" javaType="HumanResourceVO">
     <result column="NAME" property="name"/>
     </association>
  
  </resultMap>
  
  
  
  <select id="getTotal" parameterType="Pager" resultType="Long">
     SELECT *
       FROM NOTICE
      WHERE <include refid="searchNotice"></include>
      LIKE CONCAT('%','#{search}','%')
  </select>

  <select id="getDetail" parameterType="NoticeVO" resultMap="getNoticeDetail">
    SELECT *,FN_CODE_NM(LEFT(NOTICE_PRIORITY_CD,3),NOTICE_PRIORITY_CD) AS PRIOR_CD_NAME,
     FN_CODE_NM(LEFT(NOTICE_CATEGORY_CD,3),NOTICE_CATEGORY_CD) AS CATEGORY_CD_NAME
     FROM NOTICE N INNER JOIN HUMAN_RESOURCE HR
       ON N.EMPLOYEE_ID=HR.EMPLOYEE_ID
     WHERE N.NOTICE_NO=#{noticeNo}
  </select>
  
  <resultMap type="NoticeVO" id="getNoticeDetail">
     <id column="NOTICE_NO" property="noticeNo"/>
     <result column="EMPLOYEE_ID" property="employeeID"/>
     <result column="NOTICE_TITLE" property="noticeTitle"/>
     <result column="NOTICE_CONTENTS" property="noticeContents"/>
     <result column="NOTICE_HIT" property="noticeHit"/>
     <result column="PRIOR_CD_NAME" property="priorCdName"/>
     <result column="CATEGORY_CD_NAME" property="categoryCdName"/>
     
     <association property="humanResourceVO" javaType="HumanResourceVO">
     <result column="NAME" property="name"/>
     </association>
  
  </resultMap>
  
  <insert id="setAdd" parameterType="NoticeVO">
     INSERT INTO NOTICE(NOTICE_NO,EMPLOYEE_ID,NOTICE_TITLE,NOTICE_CONTENTS,NOTICE_HIT,NOTICE_PRIORITY_CD,NOTICE_CATEGORY_CD,REG_ID,REG_DATE,REG_MENU,MOD_ID,MOD_DATE,MOD_MENU)
     VALUES (#{noticeNo},#{employeeID},#{noticeTitle},#{noticeContents},0,#{noticePriorityCd},#{noticeCategoryCd},#{regId},NOW(),#{regMenu},#{modId},NOW(),#{modMenu}) 
  </insert>
  
  <update id="setUpdate" parameterType="NoticeVO">
     UPDATE NOTICE
        SET EMPLOYEE_ID=#{employeeID},NOTICE_TITLE=#{noticeTitle},
        NOTICE_CONTENTS=#{noticeContents},NOTICE_CATEGORY_CD=#{noticeCategoryCd}
        NOTICE_PRIORITY_CD=#{noticePriorityCd}
        ,MOD_ID=#{modId},MOD_DATE=NOW(),MOD_MENU=#{modMenu}
		WHERE NOTICE_NO=#{noticeNo}
  </update>

  <delete id="setDelete" parameterType="NoticeVO"> 
     DELETE FROM NOTICE
      WHERE NOTICE_NO=#{noticeNo}
  </delete>
 


</mapper>